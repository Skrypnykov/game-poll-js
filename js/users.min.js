import{URL}from"./constants.js";const statusTextSignIn=document.getElementById("statusTextSignIn"),statusTextRegister=document.getElementById("statusTextRegister"),statusTextRecovery=document.getElementById("statusTextRecovery"),profile=document.getElementById("profile"),signInOutButton=document.getElementById("signInOutButton"),registerButton=document.getElementById("registerButton"),startButton=document.getElementById("click"),userInfo=document.getElementById("userInfo");async function apiPost(a,b){const c={method:"POST",headers:{Mode:"NOCORS",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)},d=await fetch(a,c);if(!d.ok){const a=d.status+" "+d.statusText;throw new Error(a)}const e=await d.json();return e}export async function register(a){statusTextRegister.innerText="\u0412\u0438\u043A\u043E\u043D\u0443\u0454\u0442\u044C\u0441\u044F \u0440\u0435\u0454\u0441\u0442\u0440\u0430\u0446\u0456\u044F ...";return a.password===a.password1?void apiPost(`${URL}users`,a).then(()=>{statusTextRegister.innerText="\u0420\u0435\u0454\u0441\u0442\u0440\u0430\u0446\u0456\u044F \u0432\u0438\u043A\u043E\u043D\u0430\u043D\u0430",$("#modalSignUp").modal("hide"),signIn(a),setTimeout(()=>statusTextRegister.innerText="\u041F\u0430\u0440\u043E\u043B\u044C \u043D\u0435 \u043C\u0435\u043D\u0448\u0435 8 \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432.",3e3)}).catch(a=>{statusTextRegister.innerText="417 Expectation Failed"===a.message?"\u0422\u0430\u043A\u0438\u0439 email \u0430\u0431\u043E \u0442\u0435\u043B\u0435\u0444\u043E\u043D \u0432\u0436\u0435 \u0437\u0430\u0440\u0435\u0454\u0441\u0442\u0440\u043E\u0432\u0430\u043D\u0438\u0439":"\u041F\u043E\u043C\u0438\u043B\u043A\u0430 \u0440\u0435\u0454\u0441\u0442\u0440\u0430\u0446\u0456\u0457",setTimeout(()=>statusTextRegister.innerText="\u041F\u0430\u0440\u043E\u043B\u044C \u043D\u0435 \u043C\u0435\u043D\u0448\u0435 8 \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432.",3e3)}):void(statusTextRegister.innerText="\u041F\u0430\u0440\u043E\u043B\u044C \u0456 \u0439\u043E\u0433\u043E \u043F\u043E\u0432\u0442\u043E\u0440 \u043D\u0435 \u0437\u0431\u0456\u0433\u0430\u044E\u0442\u044C\u0441\u044F")}const setSignIn=()=>{localStorage.clear(),userInfo&&signInOutButton&&registerButton&&startButton&&(userInfo.innerText="\u0420\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u043E\u0432\u0430\u043D\u043E \u0432\u0438\u043A\u043E\u0440\u0438\u0441\u0442\u043E\u0432\u0443\u0432\u0430\u0442\u0438\n\u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0438 Chrome \u0430\u0431\u043E Firefox",userInfo.classList.add("smallfont"),signInOutButton.innerText="\u0412\u0445i\u0434",signInOutButton.dataset.bsToggle="modal",signInOutButton.dataset.bsTarget="#modalSignIn",registerButton.classList.remove("hidden"),profile.classList.add("hidden"))},setSignOut=()=>{signInOutButton&&registerButton&&startButton&&(signInOutButton.innerText="\u0412\u0438\u0445i\u0434",signInOutButton.addEventListener("click",setSignIn),delete signInOutButton.dataset.bsToggle,delete signInOutButton.dataset.bsTarget,registerButton.classList.add("hidden"),profile.classList.remove("hidden"))},setLocalData=a=>{const b=a;b.token&&localStorage.setItem("token",b.token),b.refreshToken&&localStorage.setItem("refreshToken",b.refreshToken),b.userId&&localStorage.setItem("userId",b.userId),delete b.token,delete b.refreshToken,delete b.userId,localStorage.setItem("userData",JSON.stringify(b))};export async function signIn(a){apiPost(URL+"signin",a).then(a=>{a.email?(statusTextSignIn.innerText="\u0412\u0445\u0456\u0434 \u0432\u0438\u043A\u043E\u043D\u0430\u043D\u043E",userInfo.classList.remove("smallfont"),userInfo.innerHTML="\u0412\u0456\u0442\u0430\u0454\u043C\u043E, <a href='/pages/account.html'>"+a.nickname+"</a>",setTimeout(()=>$("#modalSignIn").modal("hide"),1e3),setTimeout(()=>$("#modalInfo").modal("show"),1500),setLocalData(a),setSignOut()):statusTextSignIn.innerText="\u041D\u0435\u0432\u0456\u0440\u043D\u0456 \u0434\u0430\u043D\u0456",setTimeout(()=>statusTextSignIn.innerText="\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0440\u0435\u0454\u0441\u0442\u0440\u0430\u0446\u0456\u0439\u043D\u0456 \u0434\u0430\u043D\u0456.",3e3)}).catch(a=>{"403 Forbidden"===a.message?statusTextSignIn.innerText="\u041D\u0435\u0432\u0456\u0440\u043D\u0438\u0439 \u043F\u0430\u0440\u043E\u043B\u044C":"404 Not Found"===a.message?statusTextSignIn.innerText="\u041A\u043E\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0430 \u0437 \u0442\u0430\u043A\u0438\u043C email \u043D\u0435 \u0437\u043D\u0430\u0439\u0434\u0435\u043D\u043E":a.message&&(statusTextSignIn.innerText="\u041F\u043E\u043C\u0438\u043B\u043A\u0430 \u0432\u0445\u043E\u0434\u0443"),setTimeout(()=>statusTextSignIn.innerText="\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0440\u0435\u0454\u0441\u0442\u0440\u0430\u0446\u0456\u0439\u043D\u0456 \u0434\u0430\u043D\u0456.",3e3)})}export async function verifyAuth(){const a=localStorage.getItem("token"),b=localStorage.getItem("userId");if(!b||!a)return void setSignIn();const c=await fetch(URL+"users/"+b,{method:"GET",headers:{Mode:"NOCORS",Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a}});if(!c.ok)setSignIn();else{const a=await c.json();setLocalData(a),setSignOut(),userInfo.innerHTML="\u0412\u0456\u0442\u0430\u0454\u043C\u043E, <a href='/pages/account.html'>"+a.nickname+"</a>"}}export async function recovery(a){const b=URL+"users/recovery/"+a.email;apiPost(b,{}).then(a=>{a&&(statusTextRecovery.innerText="\u041B\u0438\u0441\u0442 \u0432\u0456\u0434\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E",setTimeout(()=>$("#modalRecovery").modal("hide"),2e3),setTimeout(()=>statusTextRecovery.innerText="\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0430\u0434\u0440\u0435\u0441\u0443 \u0435\u043B\u0435\u043A\u0442\u0440\u043E\u043D\u043D\u043E\u0457 \u043F\u043E\u0448\u0442\u0438",3e3))}).catch(a=>{"403 Forbidden"===a.message?statusTextRecovery.innerText="\u041D\u0435\u0432\u0456\u0440\u043D\u0438\u0439 \u043F\u0430\u0440\u043E\u043B\u044C":"404 Not Found"===a.message?statusTextRecovery.innerText="\u041A\u043E\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0430 \u0437 \u0442\u0430\u043A\u0438\u043C email \u043D\u0435 \u0437\u043D\u0430\u0439\u0434\u0435\u043D\u043E":a.message&&(statusTextRecovery.innerText="\u041F\u043E\u043C\u0438\u043B\u043A\u0430"),setTimeout(()=>statusTextRecovery.innerText="\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0430\u0434\u0440\u0435\u0441\u0443 \u0435\u043B\u0435\u043A\u0442\u0440\u043E\u043D\u043D\u043E\u0457 \u043F\u043E\u0448\u0442\u0438",3e3)})}